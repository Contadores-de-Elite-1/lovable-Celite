PROMPT 1 PARA O LOVABLE 

Ao analisar este conteÃºdo, ative seu modo MetaPrompt (Self-Correction) e refaÃ§a o prompt de forma otimizada, mantendo 100% da intenÃ§Ã£o e coerÃªncia original. Aplique refino tÃ©cnico, correÃ§Ã£o de estrutura, e gere a versÃ£o ideal para construÃ§Ã£o no Lovable com Supabase + Stripe.


INSTRUÃ‡ÃƒO AO LOVABLE (modo conversa)
Analise atentamente todo o conteÃºdo a seguir.
 Sua tarefa Ã©:
Avaliar tecnicamente e detectar inconsistÃªncias ou ambiguidades no escopo.


Corrigir e otimizar a estrutura de dados, lÃ³gica de fluxos e arquitetura.


Gerar um â€œBuild Promptâ€ definitivo, no formato ideal para o Lovable, pronto para iniciar a construÃ§Ã£o do app.


Garantir clareza, modularidade e rastreabilidade entre frontend (Lovable), backend (Supabase) e gateway de pagamento (Stripe).


ğŸ§­ CONTEXTO GERAL
O app Programa Contadores de Elite, desenvolvido pela Top Class EscritÃ³rio Virtual (Aracaju/SE), visa permitir que contadores parceiros indiquem clientes e outros contadores, gerando comissÃµes automÃ¡ticas, bonificaÃ§Ãµes de performance e acompanhamento transparente em tempo real.
Plataformas:
Frontend: Lovable (interface web/app responsiva)


Backend: Supabase (PostgreSQL, Auth, Edge Functions, Storage)


Pagamentos: Stripe (checkout + webhook + split + conciliaÃ§Ã£o)


âš™ï¸ OBJETIVOS PRINCIPAIS
Automatizar o Programa de IndicaÃ§Ã£o (rastreamento, cadastro, cobranÃ§a, cÃ¡lculo de comissÃ£o e extrato).


Rastrear e atribuir automaticamente cada cliente e contador ao parceiro que o indicou.


Integrar o Stripe para geraÃ§Ã£o de cobranÃ§as, split de pagamentos e reconciliaÃ§Ã£o via webhook.


Exibir no painel do contador:

Clientes diretos

Rede (contadores indicados)

Ganhos (diretos + override)

Alertas TIER, bÃ´nus e status de pagamento


ğŸ§© ARQUITETURA PRINCIPAL (Supabase)
Entidades centrais e campos principais:
Table
Columns
Description
contadores
id, user_id, nome, email, nivel (Bronzeâ€“Diamante), data_cadastro, ativo
Parceiros cadastrados
clientes
id, nome, cnpj, plano, valor_plano, contador_id, status
Clientes indicados
indicacoes
id, contador_id, cliente_id, origem, status, criado_em
Registra clique/conversÃ£o
rede_contadores
id, sponsor_id, child_id, criado_em
Rede de contadores (MMN)
pagamentos
id, cliente_id, tipo (ATIVACAO/RECORRENTE), valor_bruto, cashback, valor_liquido, pago_em
HistÃ³rico financeiro
comissoes
id, tipo, base_pagamento_id, contador_id, valor, competencia, status
ComissÃµes geradas
invites
id, tipo (CLIENTE/CONTADOR), emissor_id, token, expira_em, usado_em, status
GeraÃ§Ã£o de links rastreÃ¡veis


ğŸ”— RASTREAMENTO DE LINKS
Dois tipos de links rastreÃ¡veis com token HMAC (inalterÃ¡vel + TTL):
/i/:token â†’ indicaÃ§Ã£o de cliente

Grava em indicacoes, seta cookie httpOnly

flow=lp: abre mini-LP direta ao ponto

flow=checkout: gera cobranÃ§a Stripe e abre checkout imediato

/r/:token â†’ convite de contador

Cria invite e, apÃ³s cadastro, vincula em rede_contadores

TTL recomendado: 7 dias.
 Assinatura HMAC SHA-256 com secret_key Supabase.

ğŸ’° REGRAS DE COMISSÃƒO E BONIFICAÃ‡ÃƒO
Com base no documento â€œ17 BonificaÃ§Ãµes e Regrasâ€:
BÃ´nus de AtivaÃ§Ã£o: 100% do 1Âº pagamento lÃ­quido do cliente.

ComissÃ£o Recorrente: 15â€“20% sobre clientes diretos, conforme nÃ­vel.

Override Recorrente: 3â€“5% sobre clientes da rede.

Retroatividade: novas porcentagens aplicam-se Ã  carteira completa.

Penalidades (TIER):

Ano 1: 7%

Ano 2: 3%

Ano 3: 0% (perda total da carteira)

ReativaÃ§Ã£o: +4 clientes (90d) ou +6 (180d).

BÃ´nus ProgressÃ£o (nÃ£o cumulativos):

Prata: 5 clientes = R$100

Ouro: 10 = R$100

Diamante: 15 = R$100

Volume (20,25,30...): +R$100 a cada +5 clientes

BÃ´nus LTV (retenÃ§Ã£o):

5â€“9 = 15%

10â€“14 = 30%

15+ = 50% (13Âº mÃªs)

BÃ´nus Rede: R$50 por novo contador ativo.

Lead Diamante: 1 lead/mÃªs (CNPJ ativo, fit e contato verificÃ¡vel).


ğŸ“± FLUXO TÃ‰CNICO (MVP)
Contador loga â†’ gera link rastreÃ¡vel (gerar_link(tipo) â†’ token assinado).

Cliente ou contador convidado clica â†’ Edge Function valida â†’ grava indicaÃ§Ã£o.

Checkout Stripe criado com referÃªncia (indicacao_id, contador_id, cliente_id).

Webhook Stripe â†’ processar_pagamento() â†’ calcula bÃ´nus, override e atualiza comissÃµes.

Painel Lovable exibe ganhos, tiers, bÃ´nus e status.

Pagamentos automÃ¡ticos via PIX dia 25.


ğŸ§  RECURSOS ADICIONAIS
Mini-LP direta e elegante: preto, branco e bordÃ´ com CTA â€œFinalizar com SeguranÃ§aâ€.

Painel do contador: clientes diretos, rede, ganhos, leads, histÃ³rico.

Painel admin (Top Class): relatÃ³rios, auditoria, push notifications.

Auth: Supabase Auth + MFA opcional.

RLS: auth.uid() = contador.user_id (para clientes, indicacoes, comissoes, pagamentos).

SeguranÃ§a: TLS, cookies httpOnly, HMAC, idempotÃªncia nos webhooks.

LGPD: logs, consentimento, exclusÃ£o e anonimizaÃ§Ã£o.


ğŸ§° RPCs ESSENCIAIS (Supabase)
registrar_clique(token)

criar_cliente(indicacao_id, dados)

criar_cobranca_Stripe(cliente_id, indicacao_id)

processar_pagamento(evento_webhook)

fechamento_mensal(competencia)

simulador_crescimento(user_id, input_json)

resgatar_bonus(bonus_id)


Todas as RPCs devem validar request_id Ãºnico para garantir idempotÃªncia.

ğŸ§® MÃ“DULO: SIMULADOR DE CRESCIMENTO
Objetivo: estimular engajamento e fidelizaÃ§Ã£o.
 O contador ajusta parÃ¢metros simples â€” clientes/mÃªs, valor mÃ©dio, contadores convidados, produtividade da rede â€” e o app calcula ganhos diretos e indiretos.
TrÃªs cenÃ¡rios automÃ¡ticos:
Conservador: +3%/mÃªs, conversÃ£o 40%, churn 10%.


Realista: +6%/mÃªs, conversÃ£o 60%, churn 7%.


Otimista: +10%/mÃªs, conversÃ£o 75%, churn 5%.


FÃ³rmula base:
 ganhos_total = (C * P * r_direta) + (R * P * r_override) + bonus
 Resultado exibido com grÃ¡fico de linha (Chart.js) 12 meses + feedback visual.
RPC recomendada:
 simulador_crescimento(user_id, input_json) â†’ { mes, ganho_direto, ganho_total }

ğŸ® MÃ“DULO DE ENGAJAMENTO E GAMIFICAÃ‡ÃƒO HÃBRIDA
Componentes principais:
Barras de progresso: (clientes_ativos / meta_tier) Ã— 100


Sistema de XP: +10 por cliente, +20 por contador, +50 por bÃ´nus.


Badges e conquistas: tabela conquistas(id, nome, descricao, requisito_xp, icone_url)


Ranking mensal: soma comissÃµes + bÃ´nus LTV.


Push notifications: Firebase + Supabase Functions (event triggers: pagamento, tier, meta semanal).


Eventos presenciais: mÃ³dulo eventos com check-in QR code.


Resgate de bÃ´nus: RPC resgatar_bonus(bonus_id) com log.


Consentimento LGPD: checkbox â€œDesejo receber notificaÃ§Ãµesâ€.


IntegraÃ§Ã£o direta com o simulador para atualizar barras de progresso e alertas de bonificaÃ§Ã£o.

ğŸ’» DESIGN MOBILE-FIRST + EXPERIÃŠNCIA DESKTOP PREMIUM
Mobile:
Arquitetura mobile-first, grid 4-colunas, padding 24 px.


Framer Motion para transiÃ§Ãµes suaves.


Tipografia: Playfair Display + Inter.


Paleta: azul-marinho (#0A0F1F), dourado (#C7A94F), branco-off (#F8F8F4), bordÃ´ (#601D1D).


Layout vertical, botÃµes amplos, microanimaÃ§Ãµes.


Desktop:
Interface aspiracional com fundo azul e destaques dourados (15% mÃ¡ximo).


Tema escuro elegante, modo claro automÃ¡tico (prefers-color-scheme).


Selo discreto â€œPowered by Top Class EscritÃ³rio Virtualâ€.


Performance:
 Imagens < 500 KB, lazy-loading, tempo total < 2 s (rede 4G).

ğŸ›¡ï¸ SEGURANÃ‡A, RLS E IDEMPOTÃŠNCIA
MFA opcional via OTP email/SMS.


RLS Policies: auth.uid() = contador.user_id nas tabelas sensÃ­veis.


Criptografia AES-256: campos cpf, cnpj, chave_pix.


Webhook idempotente: tabela webhook_log e verificaÃ§Ã£o event_id.


Logs de auditoria: funÃ§Ã£o registrar_evento(user_id, acao, payload).


AnonimizaÃ§Ã£o LGPD: delete_request(user_id) substitui dados pessoais por hash.


PIX automÃ¡tico (dia 25): workflow validando saldo e gerando logs.


Monitoramento: integraÃ§Ã£o Supabase + Logflare.



ğŸ§  INSTRUÃ‡ÃƒO FINAL AO LOVABLE
Agora, com base em tudo o que foi descrito:
Avalie o escopo, corrija inconsistÃªncias e padronize nomes de campos e funÃ§Ãµes.


Gere o Build Prompt definitivo no formato Lovable ideal.


Assegure:


Clareza nas entidades e relaÃ§Ãµes


AutomaÃ§Ã£o dos cÃ¡lculos de comissÃ£o e penalidades


IntegraÃ§Ã£o Lovable â†” Supabase â†” Stripe


SeguranÃ§a (Auth, RLS, IdempotÃªncia, HMAC, LGPD)


Performance e manutenibilidade


Execute o modo MetaPrompt (Self-Correction) automaticamente e apresente o resultado final otimizado, fiel Ã s regras de negÃ³cio e pronto para uso no modo Build.



