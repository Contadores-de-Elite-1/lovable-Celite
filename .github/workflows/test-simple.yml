name: âœ… Test Simple (sem dependÃªncias)

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Test 1 - Secret existe
        env:
          TOKEN: ${{ secrets.CLAUDECODE_ACCESS_TOKEN }}
        run: |
          echo "ğŸ” Testando secret..."
          if [ -z "$TOKEN" ]; then
            echo "âŒ SECRET NÃƒO ENCONTRADO"
            exit 1
          else
            echo "âœ… Secret encontrado: ${TOKEN:0:10}..."
          fi

      - name: Test 2 - Webhook responde
        run: |
          echo "ğŸ” Testando webhook..."
          HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" -X POST \
            https://zytxwdgzjqrcmbnpgofj.supabase.co/functions/v1/webhook-asaas \
            -H "Content-Type: application/json" \
            -d '{"test":"ping"}')

          echo "HTTP Status: $HTTP_CODE"

          if [ "$HTTP_CODE" -ge 200 ] && [ "$HTTP_CODE" -lt 600 ]; then
            echo "âœ… Webhook estÃ¡ respondendo!"
            exit 0
          else
            echo "âŒ Webhook nÃ£o estÃ¡ respondendo"
            exit 1
          fi

      - name: Test 3 - Supabase CLI disponÃ­vel
        run: |
          echo "ğŸ” Verificando Supabase CLI..."
          npm install -g supabase
          supabase --version
          echo "âœ… Supabase CLI instalado!"

      - name: Summary
        if: always()
        run: |
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "Testes concluÃ­dos!"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
