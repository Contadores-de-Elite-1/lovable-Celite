# ğŸ¯ INSTRUÃ‡Ã•ES MANUAIS - CRIAR COBRANÃ‡A ASAAS

**Tempo:** 3 minutos | **Dificuldade:** FÃ¡cil

---

## ğŸ“ PASSO 1: Login no ASAAS Sandbox

1. Acesse: https://sandbox.asaas.com
2. FaÃ§a login com suas credenciais

---

## ğŸ“ PASSO 2: Criar CobranÃ§a

1. **No menu lateral esquerdo**, clique em **"CobranÃ§as"**

2. Clique no botÃ£o **"Nova CobranÃ§a"** (canto superior direito)

3. **Preencha o formulÃ¡rio:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DADOS DA COBRANÃ‡A                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ Cliente *                               â”‚
â”‚ [cus_000007222099          ] ğŸ”         â”‚
â”‚                                         â”‚
â”‚ (Se nÃ£o aparecer, clique no campo      â”‚
â”‚  e digite o ID)                         â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ Valor da cobranÃ§a *                     â”‚
â”‚ R$ [199,90]                             â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ Data de vencimento *                    â”‚
â”‚ [15/11/2025] ğŸ“…                         â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ Forma de pagamento *                    â”‚
â”‚ ( ) Boleto bancÃ¡rio                     â”‚
â”‚ (â€¢) PIX  â† SELECIONE                    â”‚
â”‚ ( ) CartÃ£o de crÃ©dito                   â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ DescriÃ§Ã£o (opcional)                    â”‚
â”‚ [Teste webhook V3.0 Supabase]           â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚         [Cancelar]    [Criar]           â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

4. Clique em **"Criar"**

---

## ğŸ“ PASSO 3: Marcar como Recebida

ApÃ³s criar, vocÃª verÃ¡ a tela de detalhes da cobranÃ§a:

1. **Procure pelo botÃ£o** (pode ter nomes diferentes):
   - "Confirmar Recebimento" OU
   - "Recebido" OU
   - "Marcar como Pago" OU
   - Menu de aÃ§Ãµes (â‹®) â†’ "Confirmar recebimento"

2. **Clique no botÃ£o**

3. **Confirme** o recebimento (se pedir confirmaÃ§Ã£o)

---

## ğŸ“ PASSO 4: Copiar Payment ID

1. **Na tela de detalhes da cobranÃ§a**, procure pelo **ID da cobranÃ§a**

2. O ID tem formato: `pay_000123456789` ou similar

3. **COPIE este ID!** VocÃª vai precisar dele!

**Exemplo:**
```
ID da CobranÃ§a: pay_000123456789
             ou: 11967250
```

---

## ğŸ“ PASSO 5: Aguardar Webhook

**â³ Aguarde 10-15 segundos**

O ASAAS vai enviar automaticamente o webhook para o Supabase!

---

## ğŸ“ PASSO 6: Verificar Resultado

**OpÃ§Ã£o 1: Script AutomÃ¡tico (RECOMENDADO)**

No terminal, execute:

```bash
cd /home/user/lovable-Celite
node scripts/verificar-resultado.js pay_000123456789
```

*(Substitua `pay_000123456789` pelo ID real que vocÃª copiou)*

---

**OpÃ§Ã£o 2: Queries SQL Manuais**

1. Acesse: https://supabase.com/dashboard/project/zytxwdgzjqrcmbnpgofj

2. Menu lateral â†’ **SQL Editor**

3. Clique em **"New query"**

4. Cole esta query:

```sql
-- Buscar pagamento pelo ID do ASAAS
SELECT
  p.id AS pagamento_id,
  p.tipo,
  p.valor_bruto,
  p.status,
  p.created_at,
  c.nome_empresa AS cliente
FROM pagamentos p
LEFT JOIN clientes c ON p.cliente_id = c.id
WHERE p.asaas_payment_id = 'pay_000123456789'  -- SUBSTITUA AQUI!
ORDER BY p.created_at DESC;
```

5. **IMPORTANTE:** Substitua `pay_000123456789` pelo ID real!

6. Clique em **"Run"** (botÃ£o verde)

---

## âœ… RESULTADO ESPERADO

### Se o Webhook V3.0 funcionou:

**Query deve retornar:**
```
1 linha encontrada

Campos:
â€¢ pagamento_id: uuid-xxx-xxx
â€¢ tipo: ativacao
â€¢ valor_bruto: 199.90
â€¢ status: confirmado
â€¢ created_at: 2025-11-15 XX:XX:XX
â€¢ cliente: (nome do cliente)
```

### Se nÃ£o encontrou:

**PossÃ­veis causas:**
1. â³ Webhook ainda nÃ£o processou (aguarde mais 10 segundos)
2. âŒ Erro no webhook (verificar logs)
3. âŒ Payment ID incorreto
4. âŒ VariÃ¡vel `ASAAS_API_KEY` nÃ£o configurada na Edge Function

**Verificar logs:**
https://supabase.com/dashboard/project/zytxwdgzjqrcmbnpgofj/functions/webhook-asaas/logs

---

## ğŸ“Š QUERY ADICIONAL: Ver ComissÃµes

Depois de confirmar que o pagamento existe, veja as comissÃµes geradas:

```sql
-- Buscar comissÃµes do pagamento
SELECT
  c.tipo,
  c.valor,
  c.percentual,
  c.status,
  c.nivel_sponsor
FROM comissoes c
JOIN pagamentos p ON c.pagamento_id = p.id
WHERE p.asaas_payment_id = 'pay_000123456789'  -- SUBSTITUA AQUI!
ORDER BY c.created_at;
```

**Deve retornar:** MÃºltiplas comissÃµes (ativaÃ§Ã£o + overrides)

---

## ğŸ” TROUBLESHOOTING

### "Cliente nÃ£o encontrado"

**SoluÃ§Ã£o:** O cliente `cus_000007222099` pode nÃ£o existir no ASAAS Sandbox.

**OpÃ§Ã£o 1:** Criar cliente primeiro no ASAAS:
1. ASAAS â†’ Clientes â†’ Nova Cliente
2. Preencher dados bÃ¡sicos
3. Copiar ID gerado
4. Usar esse ID na cobranÃ§a

**OpÃ§Ã£o 2:** Usar qualquer cliente existente na sua conta ASAAS

---

### "Webhook nÃ£o processou"

**VerificaÃ§Ãµes:**

1. **Webhook estÃ¡ configurado no ASAAS?**
   - ASAAS â†’ ConfiguraÃ§Ãµes â†’ Webhooks
   - URL: `https://zytxwdgzjqrcmbnpgofj.supabase.co/functions/v1/webhook-asaas`
   - Eventos marcados: `PAYMENT_RECEIVED`, `PAYMENT_CONFIRMED`

2. **VariÃ¡vel `ASAAS_API_KEY` estÃ¡ configurada?**
   - Supabase Dashboard â†’ Edge Functions â†’ webhook-asaas â†’ Secrets
   - Deve ter: `ASAAS_API_KEY` com valor da chave

3. **Logs da Edge Function:**
   - https://supabase.com/dashboard/project/zytxwdgzjqrcmbnpgofj/functions/webhook-asaas/logs
   - Procurar por erros recentes

---

## ğŸ“ CHECKLIST RÃPIDO

- [ ] Acessei ASAAS Sandbox
- [ ] Criei nova cobranÃ§a
- [ ] Cliente: `cus_000007222099` (ou outro)
- [ ] Valor: R$ 199,90
- [ ] Vencimento: Hoje
- [ ] Forma: PIX
- [ ] Marquei como recebida
- [ ] Copiei Payment ID
- [ ] Aguardei 15 segundos
- [ ] Executei verificaÃ§Ã£o (script ou SQL)
- [ ] Confirmei pagamento criado
- [ ] Confirmei comissÃµes calculadas

---

## ğŸ†˜ PRECISA DE AJUDA?

**Me passe:**
1. Payment ID que vocÃª criou
2. Screenshot da tela do ASAAS (cobranÃ§a criada)
3. Resultado da query SQL (se executou)

**Eu vou:**
- âœ… Investigar o que aconteceu
- âœ… Verificar logs do webhook
- âœ… Identificar o problema
- âœ… Fornecer soluÃ§Ã£o

---

**Data:** 2025-11-15
**VersÃ£o:** Webhook V3.0
**DocumentaÃ§Ã£o:** docs/WEBHOOK-V3-CHANGELOG.md
