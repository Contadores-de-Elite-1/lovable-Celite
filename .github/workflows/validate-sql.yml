name: Validate SQL & Migrations

on:
  push:
    branches: [main, claude/**, develop]
    paths:
      - 'supabase/**'
      - '.github/workflows/validate-sql.yml'
  pull_request:
    branches: [main, develop]
    paths:
      - 'supabase/**'

jobs:
  validate:
    runs-on: ubuntu-latest
    name: Validate SQL Files

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Validate SQL Files Exist
        run: |
          echo "ğŸ” Validating SQL files..."

          # Check migrations
          if [ -d "supabase/migrations" ]; then
            COUNT=$(ls -1 supabase/migrations/*.sql 2>/dev/null | wc -l)
            echo "âœ… Found $COUNT migration files"
          else
            echo "âš ï¸  No migrations directory"
          fi

          # Check scripts
          if [ -d "supabase/scripts" ]; then
            COUNT=$(ls -1 supabase/scripts/*.sql 2>/dev/null | wc -l)
            echo "âœ… Found $COUNT script files"
          else
            echo "âš ï¸  No scripts directory"
          fi

          echo "âœ… Validation complete"

      - name: Summary
        run: |
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âœ… SQL & Migrations Validation Passed"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
